<h2>Đăng nhập</h2>
<form id="loginForm">
    <input id="username" name="username" placeholder="Tên đăng nhập" required>
    <input id="password" name="password" type="password" placeholder="Mật khẩu" required>
    <button type="submit">Đăng nhập</button>
    <p id="loginError" style="color:red"></p>
</form>
<p>Chưa có tài khoản? <a href="/register">Đăng ký</a></p>

<script>
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const res = await fetch('/api/v1/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
    });
    const data = await res.json();
    if (data.success && data.data && data.data.token) {
        localStorage.setItem('token', data.data.token); // Lưu token vào localStorage
        // Đăng nhập server-side để tạo session/cookie
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/login';
        form.style.display = 'none';
        const userInput = document.createElement('input');
        userInput.name = 'username';
        userInput.value = username;
        form.appendChild(userInput);
        const passInput = document.createElement('input');
        passInput.name = 'password';
        passInput.value = password;
        form.appendChild(passInput);
        document.body.appendChild(form);
        form.submit();
    } else {
        document.getElementById('loginError').innerText = data.message || 'Đăng nhập thất bại';
    }
});
</script>
